@model List<PerfumeShop.Models.User>
@{
    Layout = "_AdminLayout";
}

<h2 class="mb-4">Danh sách người dùng</h2>

<table class="table table-bordered bg-white shadow">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Họ tên</th>
            <th>Email</th>
            <th>Quyền</th>
            <th>Ngày tạo</th>
            <th>Hành động</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var u in Model)
        {
            <tr>
                <td>@u.Id</td>
                <td>@u.FullName</td>
                <td>@u.Email</td>
                <td>
                    <span class="badge bg-primary">@u.Role</span>
                </td>
                <td>@u.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                <td>
                    <button class="btn btn-sm btn-warning"
                            onclick="openRolePopup(@u.Id, '@u.Role', '@u.FullName')">
                        ⚙ Đổi quyền
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>


<!-- =========================================
     POPUP ĐỔI QUYỀN
========================================= -->
<div class="modal fade" id="roleModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <form method="post" action="/AdminUser/Edit">

                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">Thay đổi quyền người dùng</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <input type="hidden" id="userId" name="id" />

                    <p><strong>Tài khoản:</strong> <span id="userFullName"></span></p>

                    <label class="mt-2 mb-1">Chọn quyền mới</label>

                    <select class="form-control" id="roleSelect" name="role">
                        <option value="Admin">Admin</option>
                        <option value="Staff">Staff</option>
                        <option value="User">User</option>
                    </select>

                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Lưu thay đổi</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                </div>

            </form>

        </div>
    </div>
</div>


<!-- =========================================
     SCRIPT MỞ POPUP
========================================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function openRolePopup(id, role, fullName) {

        document.getElementById("userId").value = id;
        document.getElementById("userFullName").innerText = fullName;

        // set role mặc định
        document.getElementById("roleSelect").value = role;

        // mở popup
        var modal = new bootstrap.Modal(document.getElementById('roleModal'));
        modal.show();
    }
</script>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    @if (Context.Request.Query["success"] == "1")
    {
        <script>
            Swal.fire({
                icon: "success",
                title: "Update thành công",
                showConfirmButton: false,
                timer: 1500
            });
        </script>
    }
}